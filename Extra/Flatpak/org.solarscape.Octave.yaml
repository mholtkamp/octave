id: org.solarscape.Octave
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
command: OctaveEditor
modules:
  - name: VulkanSDK
    buildsystem: simple
    build-commands:
      - ls -lah
      - cp -r x86_64 /app/VulkanSDK
    sources:
      - type: archive
        url: https://sdk.lunarg.com/sdk/download/1.3.275.0/linux/vulkansdk-linux-x86_64-1.3.275.0.tar.xz
        sha256: b64c5b7634e7d71e28e3ea3d0b775234cbc18ce2f4e7a031341a4f9f6e4673b5
  - name: Octave
    buildsystem: simple
    build-commands:
      - pwd
      - ls -lah
      - echo $VULKAN_SDK
      - which glslc
      - cd Standalone && make -j 12 -f Makefile_Linux_Editor
      - cd Standalone && make -j 12 -f Makefile_Linux_Game
      - cd Engine/Shaders/GLSL && ./compile.sh
      - mkdir /app/Octave
      - cp Standalone/Build/Linux/OctaveEditor.out /app/Octave/OctaveEditor
      - git clean -xdf "*/Intermediate/*" "*/Build/*"
      - cp -r Engine External Documentation OctaveLogo*.png Standalone /app/Octave
      - install -Dm644 Extra/Flatpak/${FLATPAK_ID}.desktop -t /app/share/applications
      - install -Dm644 OctaveLogo_128.png /app/share/icons/hicolor/128x128/apps/${FLATPAK_ID}.png
      #- rsync -a --exclude 'Build' --exclude 'Intermediate' Engine External Documentation OctaveLogo*.png Standalone /app/Octave
    build-options:
      env:
        VULKAN_SDK: /app/VulkanSDK
        PATH: /app/VulkanSDK/bin:/usr/bin:/app/bin
        LIBRARY_PATH: /app/VulkanSDK/lib:${LIBRARY_PATH}
        LD_LIBRARY_PATH: /app/VulkanSDK/lib:${LD_LIBRARY_PATH}
    sources:
      - type: git
        url: https://github.com/mholtkamp/octave.git
        branch: main
        disable-submodules: true
  - name: OctaveScript
    buildsystem: simple
    build-commands:
      - install -Dm755 OctaveEditor.sh /app/bin/OctaveEditor
    sources:
      - type: script
        dest-filename: OctaveEditor.sh
        commands:
          - echo "Launching Octave Editor"
          - pwd
          - cd /app/Octave
          - pwd
          - ls -lah
          - cd Engine/Shaders/GLSL/bin
          - ls -lah
          - cd -
          - pwd
          - ./OctaveEditor
finish-args:
  # X11 + XShm access
  - --share=ipc
  - --socket=x11
  - --socket=pulseaudio
  # GPU acceleration if needed
  - --device=dri
  # Needs to talk to the network:
  - --share=network
  # Needs to save files locally
  - --filesystem=host